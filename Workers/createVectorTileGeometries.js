/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.110
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */
import{a as P}from"./chunk-YAEMR6BE.js";import{a as z}from"./chunk-7HLUXH7B.js";import"./chunk-K6KKGJV3.js";import{a as H}from"./chunk-MLSGXY4I.js";import{a as Y}from"./chunk-T2JXMNUX.js";import{a as j}from"./chunk-XR7WZKTO.js";import"./chunk-RC3J75N5.js";import"./chunk-H77XG57N.js";import{a as W}from"./chunk-7P3UWTUX.js";import"./chunk-GIF3NIGD.js";import"./chunk-7VHC7I6W.js";import{d as E}from"./chunk-VNH2ZAFU.js";import"./chunk-2YKWURU2.js";import{b as d}from"./chunk-TL76KVMB.js";import"./chunk-EK7K4JTS.js";import{a as o}from"./chunk-TZVAMLG3.js";import"./chunk-7IOYEWZQ.js";import"./chunk-XE4KLUZ2.js";import"./chunk-TL6AL3PA.js";import"./chunk-DYKDQ7Q5.js";import"./chunk-57R6MEVR.js";import{e as l}from"./chunk-KNXNZS2Q.js";function X(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var J=X,S=new o,$=d.packedLength+o.packedLength,ee=d.packedLength+2,ne=d.packedLength+o.packedLength,te=o.packedLength+1,u={modelMatrix:new d,boundingVolume:new E};function oe(e,t){let n=t*$,r=o.unpack(e,n,S);n+=o.packedLength;let i=d.unpack(e,n,u.modelMatrix);d.multiplyByScale(i,r,i);let s=u.boundingVolume;return o.clone(o.ZERO,s.center),s.radius=Math.sqrt(3),u}function ce(e,t){let n=t*ee,r=e[n++],i=e[n++],s=o.fromElements(r,r,i,S),a=d.unpack(e,n,u.modelMatrix);d.multiplyByScale(a,s,a);let l=u.boundingVolume;return o.clone(o.ZERO,l.center),l.radius=Math.sqrt(2),u}function se(e,t){let n=t*ne,r=o.unpack(e,n,S);n+=o.packedLength;let i=d.unpack(e,n,u.modelMatrix);d.multiplyByScale(i,r,i);let s=u.boundingVolume;return o.clone(o.ZERO,s.center),s.radius=1,u}function ie(e,t){let n=t*te,r=e[n++],i=o.unpack(e,n,S),s=d.fromTranslation(i,u.modelMatrix);d.multiplyByUniformScale(s,r,s);let a=u.boundingVolume;return o.clone(o.ZERO,a.center),a.radius=1,u}var de=new o;function R(e,t,n,r,i){if(!l(t))return;let s=n.length,a=r.attributes.position.values,c=r.indices,u=e.positions,f=e.vertexBatchIds,h=e.indices,p=e.batchIds,m=e.batchTableColors,b=e.batchedIndices,k=e.indexOffsets,g=e.indexCounts,y=e.boundingVolumes,I=e.modelMatrix,x=e.center,w=e.positionOffset,j=e.batchIdIndex,A=e.indexOffset,B=e.batchedIndicesOffset;for(let l=0;l<s;++l){let e=i(t,l),r=e.modelMatrix;d.multiply(I,r,r);let s=n[l],L=a.length;for(let t=0;t<L;t+=3){let e=o.unpack(a,t,de);d.multiplyByPoint(r,e,e),o.subtract(e,x,e),o.pack(e,u,3*w+t),f[j++]=s}let U=c.length;for(let t=0;t<U;++t)h[A+t]=c[t]+w;let O=l+B;b[O]=new J({offset:A,count:U,color:P.fromRgba(m[s]),batchIds:[s]}),p[O]=s,k[O]=A,g[O]=U,y[O]=E.transform(e.boundingVolume,r),w+=L/3,A+=U}e.positionOffset=w,e.batchIdIndex=j,e.indexOffset=A,e.batchedIndicesOffset+=s}var K=new o,Q=new d;function re(e){let t=new Float64Array(e),n=0;o.unpack(t,n,K),n+=o.packedLength,d.unpack(t,n,Q)}function le(e){let t=e.length,n=0;for(let o=0;o<t;++o)n+=P.packedLength+3+e[o].batchIds.length;return n}function ae(e,t,n){let o=n.length,r=2+o*E.packedLength+1+le(t),i=new Float64Array(r),s=0;i[s++]=e,i[s++]=o;for(let l=0;l<o;++l)E.pack(n[l],i,s),s+=E.packedLength;let a=t.length;i[s++]=a;for(let l=0;l<a;++l){let e=t[l];P.pack(e.color,i,s),s+=P.packedLength,i[s++]=e.offset,i[s++]=e.count;let n=e.batchIds,o=n.length;i[s++]=o;for(let t=0;t<o;++t)i[s++]=n[t]}return i}function fe(e,t){let n=l(e.boxes)?new Float32Array(e.boxes):void 0,o=l(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,r=l(e.cylinders)?new Float32Array(e.cylinders):void 0,i=l(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,s=l(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,a=l(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,c=l(e.spheres)?new Float32Array(e.spheres):void 0,d=l(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,u=l(n)?o.length:0,f=l(r)?i.length:0,h=l(s)?a.length:0,p=l(c)?d.length:0,m=j.getUnitBox(),b=z.getUnitCylinder(),k=H.getUnitEllipsoid(),g=m.attributes.position.values,y=b.attributes.position.values,I=k.attributes.position.values,x=g.length*u;x+=y.length*f,x+=I.length*(h+p);let w=m.indices,A=b.indices,B=k.indices,E=w.length*u;E+=A.length*f,E+=B.length*(h+p);let L=new Float32Array(x),U=new Uint16Array(x/3),O=W.createTypedArray(x/3,E),v=u+f+h+p,M=new Uint16Array(v),T=new Array(v),V=new Uint32Array(v),S=new Uint32Array(v),X=new Array(v);re(e.packedBuffer);let Z={batchTableColors:new Uint32Array(e.batchTableColors),positions:L,vertexBatchIds:U,indices:O,batchIds:M,batchedIndices:T,indexOffsets:V,indexCounts:S,boundingVolumes:X,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:Q,center:K};R(Z,n,o,m,oe),R(Z,r,i,b,ce),R(Z,s,a,k,se),R(Z,c,d,k,ie);let C=ae(O.BYTES_PER_ELEMENT,T,X);return t.push(L.buffer,U.buffer,O.buffer),t.push(M.buffer,V.buffer,S.buffer),t.push(C.buffer),{positions:L.buffer,vertexBatchIds:U.buffer,indices:O.buffer,indexOffsets:V.buffer,indexCounts:S.buffer,batchIds:M.buffer,packedBuffer:C.buffer}}var Oe=Y(fe);export{Oe as default};